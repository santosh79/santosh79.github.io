<!doctype html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <link rel="alternate" type="application/atom+xml" title="Comparison of MRI and JRuby GC's for a MMO Game Server - feed" href="/index.xml" />

    <script type="text/javascript">
      if((navigator.userAgent.match(/iPad/i))) {
        document.write("<meta name=\"viewport\" content=\"width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;\" />");
      } else if((navigator.userAgent.match(/iPhone/i))) {
        document.write("<meta name=\"viewport\" content=\"width=device-width; initial-scale=0.5; maximum-scale=1.0; user-scalable=1;\" />");
      }
    </script>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 
    <title>Comparison of MRI and JRuby GC's for a MMO Game Server</title>
  </head>
  <body>
    <header id="main_header">
      <span>
        <a href="/">blog</a>
      </span>
      <span>
        <a href="http://santosh79.tumblr.com" target="_blank">tumblog</a>
      </span>
      <span>
        <a href="http://github.com/santosh79/" target="_blank">github</a>
      </span>
      <span>
        <a href="http://twitter.com/santosh79" target="_blank">@santosh79</a>
      </span>
      <span>
        <a href="/images/resume.html">resume</a>
      </span>
    </header>
    <section>
      <article class="post">
  <header>
    <div class="date_article_page">January 2nd 2012</div>
    <h1>Comparison of MRI and JRuby GC's for a MMO Game Server</h1>
  </header>

  <section class="content">
    <p>I&rsquo;ve been looking at using Ruby for building up a stateless game server in a MMO setting. Ruby to many people, means Rails, which in turn means, a web app. The typical web app request when viewed through the lens of memory (allocation &amp; deallocation) and IO (DB writes &amp; reads) looks as follows:</p>

<p><img src="/images/mri-jvm-image_1.jpg" alt="Web Request Profile" /></p>

<p>Now, depending on the app you are building and the database you are using and the language you are using you <em>may</em> hit a bottleneck either while allocating or deallocating memory (GC slowness) or while doing IO (latency, DB size etc.). A request to a game server on the other hand looks something like this:</p>

<p><img src="/images/mri-jvm-image_2.jpg" alt="Game Server Request Profile" /></p>

<p>As you can see in the case of a game server, the garbage collector (GC) is really under the gun to perform under extreme stress. With this in mind, I decided to evaluate jruby-1.6.5 and ruby-1.9.2 to see which of these two rubies performs better under the IO characteristic the game server is going to be put through. I created the following two scripts: one for <a href="https://gist.github.com/1553926">MRI</a> and the other for <a href="https://gist.github.com/1553930">Jruby</a>. The only difference being, that in Jruby I was using Threads while in MRI I&rsquo;m using straight up Kernel processes, since I want to do real parallelism and ruby thread&rsquo;s in MRI don&rsquo;t do real parallelism, as they still have a GIL.</p>

<h3>Results</h3>

<p>I knew the JVM has a way better GC, but boy did I underestimate it:</p>

<p><img src="/images/mri-jvm-gc-comparison.jpg" alt="Results" /></p>

<p>When 20,000 Objects get created and reaped in every request MRI 1.9.2 breaks down at 300 requests per second, while JRuby is at a swaggering 800 req/sec. Once you start getting down to the 3,000 Objects created &amp; reaped per request region, JRuby really starts to differentiate itself at 3600 req/sec while MRI stalls at 1760 req/sec. The JVM&rsquo;s GC is just way more performant!</p>

<h3>Settings</h3>

<p>I ran these using <a href="https://rvm.beginrescueend.com/">RVM</a> on a Mac Book Air 1.6 Ghz Intel i5 4GB RAM, fwiw.</p>

  </section>

  <section class="comments">

    <div id="disqus_thread"></div>
    <script type='text/javascript' src='http://santosh-log.disqus.com/embed.js'></script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>


  </section>
</article>

 
    </section>
  
  
  
  
  
  
  </body>
</html>

